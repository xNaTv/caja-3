<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title><i>Caja 3</i></title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Dancing Script', cursive;
      background-color: #ffeef2;
      overflow: hidden;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .contenedor-principal {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 60px;
    }

    .ruleta-contenedor {
      text-align: center;
      margin-right: 60px;
    }

    canvas {
      margin: 0 auto;
      display: block;
    }

    #boton {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1.2em;
      background-color: #ff69b4;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-family: 'Dancing Script', cursive;
    }

    #resultado, #advertencia {
      margin-top: 15px;
      font-size: 1.2em;
      color: #c2185b;
      font-style: italic;
    }

    #texto-explicativo {
      font-size: 1.3em;
      max-width: 300px;
      font-style: italic;
      color: #7b1fa2;
      margin-left: -30px;
    }
  </style>
</head>
<body>
  <div class="contenedor-principal">
    <div class="ruleta-contenedor">
      <canvas id="ruleta" width="300" height="300"></canvas>
      <button id="boton">Girar Ruleta</button>
      <div id="resultado"></div>
      <div id="advertencia"></div>
    </div>
    <div id="texto-explicativo">
      Para conseguir el código,<br>
      debés girar la ruleta.<br>
      Y enviarme lo que toque,<br>
      con gracia, sin treta.<br><br>

      Puede que sea tierno,<br>
      divertido o atrevido,<br>
      pero solo si lo hacés,<br>
      te daré lo prometido.<br><br>

      No busques trampa ni atajo,<br>
      jugá con el corazón,<br>
      que el código lo guardo yo,<br>
      con todo mi amor y razón.
    </div>
  </div>

  <script>
    const canvas = document.getElementById("ruleta");
    const ctx = canvas.getContext("2d");
    const boton = document.getElementById("boton");
    const resultado = document.getElementById("resultado");
    const advertencia = document.getElementById("advertencia");

    const opciones = ["Beso", "Abrazo", "Video lindo", "Confesión", "Cita", "Foto tuya"];
    const colores = ["#f8bbd0", "#f48fb1", "#f06292", "#ec407a", "#e91e63", "#ad1457"];
    const numOpciones = opciones.length;
    const angulo = (2 * Math.PI) / numOpciones;
    let anguloInicio = 0;
    let giro = 0;

    function dibujarRuleta() {
      for (let i = 0; i < numOpciones; i++) {
        ctx.beginPath();
        ctx.fillStyle = colores[i];
        ctx.moveTo(150, 150);
        ctx.arc(150, 150, 150, anguloInicio + i * angulo, anguloInicio + (i + 1) * angulo);
        ctx.fill();
        ctx.save();
        ctx.translate(150, 150);
        ctx.rotate(anguloInicio + i * angulo + angulo / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "white";
        ctx.font = "18px Arial";
        ctx.fillText(opciones[i], 130, 10);
        ctx.restore();
      }

      // Dibujar flecha
      ctx.beginPath();
      ctx.moveTo(150, 0);
      ctx.lineTo(140, 20);
      ctx.lineTo(160, 20);
      ctx.fillStyle = "black";
      ctx.fill();
    }

    function girarRuleta() {
      boton.style.display = "none";
      advertencia.innerText = "no hagas trampa amor, toco y toco";

      const vueltas = Math.floor(Math.random() * 4 + 5);
      const randomOpcion = Math.floor(Math.random() * numOpciones);
      const destinoAngulo = (2 * Math.PI * vueltas) + (randomOpcion * angulo) + angulo / 2;

      let duracion = 3000;
      let inicio = null;

      function animar(timestamp) {
        if (!inicio) inicio = timestamp;
        const progreso = timestamp - inicio;
        const avance = Math.min(progreso / duracion, 1);
        giro = destinoAngulo * easeOut(avance);
        anguloInicio = giro % (2 * Math.PI);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        dibujarRuleta();
        if (avance < 1) {
          requestAnimationFrame(animar);
        } else {
          resultado.innerText = `Te tocó: ${opciones[randomOpcion]}`;
        }
      }

      requestAnimationFrame(animar);
    }

    function easeOut(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    dibujarRuleta();
    boton.addEventListener("click", girarRuleta);
  </script>
</body>
</html>
